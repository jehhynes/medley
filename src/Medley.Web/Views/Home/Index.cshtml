@model Medley.Web.Models.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

@section Styles {
<style>
    .dashboard-container {
        padding: 2rem;
        max-width: 1400px;
        margin: 0 auto;
    }

    .dashboard-header {
        margin-bottom: 2rem;
    }

    .dashboard-header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.5rem;
    }

    .dashboard-header p {
        font-size: 1.1rem;
        opacity: 0.7;
    }

    /* Metric Cards */
    .metric-card {
        background: var(--bs-body-bg);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        border: 1px solid var(--bs-border-color);
        height: 100%;
        animation: fadeInUp 0.6s ease forwards;
        opacity: 0;
    }

    .metric-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }

    .metric-card.delay-1 { animation-delay: 0.1s; }
    .metric-card.delay-2 { animation-delay: 0.2s; }
    .metric-card.delay-3 { animation-delay: 0.3s; }
    .metric-card.delay-4 { animation-delay: 0.4s; }
    .metric-card.delay-5 { animation-delay: 0.5s; }
    .metric-card.delay-6 { animation-delay: 0.6s; }

    @@keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .metric-card-title {
        font-size: 0.9rem;
        color: var(--bs-secondary-color);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.5rem;
        font-weight: 600;
    }

    .metric-card-value {
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .metric-card-icon {
        font-size: 2rem;
        opacity: 0.3;
    }

    .chart-card {
        background: var(--bs-body-bg);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border: 1px solid var(--bs-border-color);
        height: 100%;
        animation: fadeInUp 0.6s ease forwards;
        opacity: 0;
    }

    .chart-card-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: var(--bs-body-color);
    }

    .chart-container {
        position: relative;
        height: 300px;
    }

    .chart-container.small {
        height: 250px;
    }

    .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        margin-top: 2rem;
        color: var(--bs-body-color);
    }

</style>
}

<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Medley</h1>
        <p>AI-Powered Product Intelligence Platform</p>
    </div>

    <!-- Overview Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="metric-card delay-1">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="metric-card-title">Total Sources</div>
                        <div class="metric-card-value" id="totalSources">@Model.Metrics.TotalSources</div>
                    </div>
                    <i class="bi bi-camera-video metric-card-icon"></i>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="metric-card delay-2">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="metric-card-title">Total Fragments</div>
                        <div class="metric-card-value" id="totalFragments">@Model.Metrics.TotalFragments</div>
                    </div>
                    <i class="bi bi-puzzle metric-card-icon"></i>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="metric-card delay-3">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="metric-card-title">Total Articles</div>
                        <div class="metric-card-value" id="totalArticles">@Model.Metrics.TotalArticles</div>
                    </div>
                    <i class="bi bi-file-text metric-card-icon"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Source Metrics -->
    <h2 class="section-title"><i class="bi bi-camera-video me-2"></i>Source Analytics</h2>
    <div class="row g-3 mb-4">
        @if (Model.Metrics.SourcesByType.Count > 1)
        {
            <div class="col-lg-6">
                <div class="chart-card delay-4">
                    <h3 class="chart-card-title"><i class="bi bi-camera-video me-2"></i>Sources by Type</h3>
                    <div class="chart-container">
                        <canvas id="sourcesByTypeChart"></canvas>
                    </div>
                    <div id="sourcesByTypeLegend" class="mt-3 text-center"></div>
                </div>
            </div>
        }
        @if (Model.Metrics.SourcesByIntegration.Count > 1)
        {
            <div class="col-lg-6">
                <div class="chart-card delay-5">
                    <h3 class="chart-card-title"><i class="bi bi-camera-video me-2"></i>Sources by Integration</h3>
                    <div class="chart-container">
                        <canvas id="sourcesByIntegrationChart"></canvas>
                    </div>
                    <div id="sourcesByIntegrationLegend" class="mt-3 text-center"></div>
                </div>
            </div>
        }

        <div class="col-lg-6">
            <div class="chart-card delay-2">
                <h3 class="chart-card-title">Sources by Year</h3>
                <div class="chart-container">
                     <canvas id="sourcesByYearChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="chart-card delay-3">
                <h3 class="chart-card-title">Sources by Month</h3>
                <div class="chart-container">
                     <canvas id="sourcesByMonthChart"></canvas>
                </div>
            </div>
        </div>

    </div>

    <!-- Processing Status -->
    <h2 class="section-title"><i class="bi bi-hourglass-split me-2"></i>Processing Status</h2>
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="metric-card delay-2">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="metric-card-title">Fragments Pending Embedding</div>
                        <div class="metric-card-value">@Model.Metrics.FragmentsPendingEmbedding</div>
                        <small style="opacity: 0.9;">of @Model.Metrics.TotalFragments total</small>
                    </div>
                    
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="metric-card delay-3">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="metric-card-title">Sources Pending Smart Tagging</div>
                        <div class="metric-card-value">@Model.Metrics.SourcesPendingSmartTagging</div>
                        <small style="opacity: 0.9;">of @Model.Metrics.TotalSources total</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="metric-card delay-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="metric-card-title">Sources Pending Fragment Generation</div>
                        <div class="metric-card-value">@Model.Metrics.SourcesPendingFragmentGeneration</div>
                        <small style="opacity: 0.9;">of @Model.Metrics.TotalSources total</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Analytics (Fragments & Articles) -->
    <h2 class="section-title">Content Analytics</h2>
    <div class="row g-3 mb-4">
        <div class="col-lg-6">
            <div class="chart-card delay-4">
                <h3 class="chart-card-title"><i class="bi bi-puzzle me-2"></i>Fragments by Category</h3>
                <div class="chart-container small">
                    <canvas id="fragmentsByCategoryChart"></canvas>
                </div>
                <div id="fragmentsByCategoryLegend" class="mt-3 text-center"></div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="chart-card delay-5">
                <h3 class="chart-card-title"><i class="bi bi-file-text me-2"></i>Articles by Type</h3>
                <div class="chart-container small">
                    <canvas id="articlesByTypeChart"></canvas>
                </div>
                <div id="articlesByTypeLegend" class="mt-3 text-center"></div>
            </div>
        </div>
    </div>

    <!-- Tag Analytics -->
    <h2 class="section-title"><i class="bi bi-tags me-2"></i>Tag Analytics</h2>
    <div class="row g-3 mb-4">
        @foreach (var tagMetric in Model.Metrics.SourcesByTagType)
        {
            var safeId = System.Text.RegularExpressions.Regex.Replace(tagMetric.TagTypeName, "[^a-zA-Z0-9]", "");
            <div class="col-lg-6">
                <div class="chart-card">
                    <h3 class="chart-card-title">Sources by @tagMetric.TagTypeName</h3>
                    <div class="chart-container small">
                         <canvas id="tagChart_@safeId"></canvas>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
<script src="~/lib/chart.js/dist/chart.umd.min.js" asp-append-version="true"></script>
<script src="~/lib/chartjs-plugin-datalabels/dist/chartjs-plugin-datalabels.min.js" asp-append-version="true"></script>
<script src="~/js/utils.js" asp-append-version="true"></script>
<script src="~/js/pages/home.js" asp-append-version="true"></script>
<script>
    // Initialize dashboard with server-side metrics
    const metrics = {
        totalSources: @Model.Metrics.TotalSources,
        totalFragments: @Model.Metrics.TotalFragments,
        totalArticles: @Model.Metrics.TotalArticles,
        sourcesByType: @Html.Raw(Json.Serialize(Model.Metrics.SourcesByType)),
        sourcesByIntegration: @Html.Raw(Json.Serialize(Model.Metrics.SourcesByIntegration)),
        sourcesByYear: @Html.Raw(Json.Serialize(Model.Metrics.SourcesByYear)),
        sourcesByMonth: @Html.Raw(Json.Serialize(Model.Metrics.SourcesByMonth)),
        fragmentsByCategory: @Html.Raw(Json.Serialize(Model.Metrics.FragmentsByCategory)),
        articlesByType: @Html.Raw(Json.Serialize(Model.Metrics.ArticlesByType)),
        sourcesByTagType: @Html.Raw(Json.Serialize(Model.Metrics.SourcesByTagType))
    };

    window.addEventListener('load', () => {
        window.DashboardApp.initializeDashboard(metrics);
    });
</script>
}
